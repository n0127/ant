<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title data-value="">奖品详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/swiper-3.4.2.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/index.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/iconfont.css"/>
	</head>
	<body>
				<div class="Gameload">
					<img src="../../img/WelfareDraw01.png" />
				</div>
			  <!--奖品详情-->
			    <div class="Game">
			    	<div class="public-header">
			    		<div class="return">
			    			<div class="mui-push-left"></div>
			    			<span data-value="" class="">奖品详情</span>
			    		</div>
			    	</div>
			    	<div class="GameRecordBox">
			    		<div class="GameRecordList01">
			    			<div class="mui-scroll-wrapper mui-content GaneRecordPage"  style="padding-bottom: 40px;">
								<div style="padding-bottom: 40px;" class="mui-scroll">
			    					<div class="CloundPurchaseDetailsBox">
		    							<div class="mui-slider">
											<div class="mui-slider-group mui-slider-loop">
											    <!--<div class="mui-slider-item Cloud-indicator mui-slider-item-duplicate"><a href="#"><img src="../../img/Cloud03.jpg" /></a></div>
											    
											    <div class="mui-slider-item Cloud-indicator"><a href="#"><img src="../../img/Cloud01.jpg" /></a></div>
											    <div class="mui-slider-item Cloud-indicator"><a href="#"><img src="../../img/Cloud02.jpg" /></a></div>
											    <div class="mui-slider-item Cloud-indicator"><a href="#"><img src="../../img/Cloud03.jpg" /></a></div>
											    
											    <div class="mui-slider-item mui-slider-item-duplicate Cloud-indicator"><a href="#"><img src="../../img/Cloud01.jpg" /></a></div>-->
											</div>
											<div class="mui-slider-indicator">
												<!--<div class="mui-indicator mui-active"></div>
												<div class="mui-indicator"></div>
												<div class="mui-indicator"></div>-->
											</div>								
					      				</div>
					      				<div class="CloundPurchaseDetailsCon">
					      					<p>Apple iPhone X (A1865) 64GB 深空灰色 4G全网通</p>
					      					<span>LED 背光宽，Retina HD 高清显示屏，1920 x 1080 像素分辨率，Multi-Touch 显示屏</span>
					      					<div class="CloundPurchaseDetailsTime">
					      						<div><div><span>价值：¥</span><span class="totalMarketPrice">8888.00</span></div><div class="totalAwardPriceAnt"><p>云购价格：</p><p>100</p><p>通证/份</p></div></div>
					      						<div class="TimeBox"><span>00:</span><span>00:</span><span>00</span></div>
					      					</div>
					      					<div class="MyTimesBox"><span>我的购买份数：</span><span class="my_buyed_times"></span></div>
					      					<div class="CloundPurchaseDetailsNumber">
					      						<span>我要云购:</span>
					      						<p class="CloudCut">-</p>
					      						<input value="1" type="number" />
					      						<p class="CloudAdd">+</p>
					      					</div>
					      					<div class="CloundPurchaseDetailsBut">
					      						<button>立即云购</button>
					      						<p>购买份数越多获得几率越大哦！</p>
					      						<div>
					      							<span><img src="../../img/CloudPurchaseDetails01.png"/>100%公平公正</span>
					      							<span><img src="../../img/CloudPurchaseDetails02.png"/>100%正品保障</span>
					      							<span><img src="../../img/CloudPurchaseDetails03.png"/>免费配送</span>
					      						</div>
					      					</div>
					      				</div>
			    					</div>
			    				</div>
			    			</div>
			    		</div>
			    	</div>
			    </div>
			    
			    <div class="mui-content" id="paymentCode">
			    	<a href="#" id="close"></a>
		            <table id="number_input" border="0" cellspacing="0" cellpadding="0">
		                <tbody>
		                	<tr><td data-value="Enterpaymentpassword" colspan="6" style="text-align: left;color: #62C2A6;">输入支付密码</td></tr>
		                    <tr>
		                        <td class="input-item"></td>
		                        <td class="input-item"></td>
		                        <td class="input-item"></td>
		                        <td class="input-item"></td>
		                        <td class="input-item"></td>
		                        <td class="input-item"></td>
		                    </tr>
		                    <tr>
		                    	<td colspan="6" style="text-align: right;"><a data-value="Forgottopaymentpassword" class="forget" href="#" style="color: #62C2A6;">忘记支付密码?</a></td>
		                    </tr>
		                </tbody>
		            </table>
		            <table id="keyboard" border="0" cellspacing="0" cellpadding="0">
		                <tbody>
		                    <tr>
		                        <td class="keyboard-number">1</td>
		                        <td class="keyboard-number">2</td>
		                        <td class="keyboard-number">3</td>
		                    </tr>
		                    <tr>
		                        <td class="keyboard-number">4</td>
		                        <td class="keyboard-number">5</td>
		                        <td class="keyboard-number">6</td>
		                    </tr>
		                    <tr>
		                        <td class="keyboard-number">7</td>
		                        <td class="keyboard-number">8</td>
		                        <td class="keyboard-number">9</td>
		                    </tr>
		                    <tr>
		                        <td class="keboard-action" data-value="CLR" data-action="reset">清空</td>
		                        <td class="keyboard-number">0</td>
		                        <td class="keboard-action" data-value="DEL" data-action="cancel">删除</td>
		                    </tr>
		                </tbody>
		            </table>
		        </div>
	</body>
</html>
<script type="text/javascript" src="../../js/jquery-3.3.1.min.js" ></script>
<script type="text/javascript" src="../../js/mui.js" ></script>
<script type="text/javascript" src="../../js/rem.js" ></script>
<script type="text/javascript" src="../../js/ajax.js" ></script>
<script type="text/javascript" src="../../js/LanguagePackage.js" ></script>
<script type="text/javascript" src="../../js/language.js" ></script>
<script>
	
	
//	function getlotteryLogTopFor1(){
//		var This=this;
//		setTimeout(function(){
//			This.endPullupToRefresh(true);
//		},2000)
//	}
//
//	mui.init({
//		pullRefresh: {
//			container: '.GaneRecordPage',
//			up: {
//				contentinit: '上拉显示更多',
//              contentdown: '上拉显示更多',
//              contentrefresh: '正在加载...',
//              contentnomore: '已经全部加载完了...',
//				callback: getlotteryLogTopFor1
//			}
//		}
//	});
	var userId;
	var token;
	var CloudId;
	var clientType;
	var language;
	var flag=true;
	
	if(localStorage.getItem("set-lan")=="EN"){
		language="en"
	}else{
		language="cn"
	}
	
	if(hehe!=undefined){
		$(".Gameload").hide()
	}else{
		CloudId=sessionStorage.getItem("CloudId");
		userId=sessionStorage.getItem("userId")
		token=sessionStorage.getItem("token")
		clientType=2;
		CloudDetails()
	}
	function DAPPFrameworkEngineReady(){
		DAPPFramework.View.SetScrollEnabled(false);
		userId=DAPPFramework.Storage.Get("userId")
		token=DAPPFramework.Storage.Get("token")
		CloudId=DAPPFramework.SharedBoard.Get("CloudId")
		clientType=1;
		CloudDetails()
	}
	
	function CloudDetails(){
		getActivityDetail(userId,token,clientType,language,CloudId)
		$(".CloundPurchaseDetailsCon>p").text(getActivityDetailArr.data.yunGouName)
		$(".CloundPurchaseDetailsCon>span").text(getActivityDetailArr.data.yunGouDesc)
		$(".totalMarketPrice").text(getActivityDetailArr.data.totalMarketPrice)
		$(".totalAwardPriceAnt>p:nth-child(2)").text(getActivityDetailArr.data.totalAwardPriceAnt)
		$('.my_buyed_times').text(getActivityDetailArr.data.my_buyed_times)

		CloudStr=getActivityDetailArr.data.awards[0].awardMasterPictures
		CloudArr=CloudStr.split(",")
		$(".mui-slider-group").append("<div class='mui-slider-item Cloud-indicator mui-slider-item-duplicate'><a href='#'><img src='"+CloudArr[CloudArr.length-1]+"' /></a></div>")
		CloudArr.forEach(function(item){
			$(".mui-slider-group").append(
				"<div class='mui-slider-item Cloud-indicator'><a href='#'><img src='"+item+"' /></a></div>"
			)
			if(flag){
				CloudActive="<div class='mui-indicator mui-active'></div>";
				flag=false;
			}else{
				CloudActive="<div class='mui-indicator'></div>";
			}
			$(".mui-slider-indicator").append(CloudActive)
		})
		$(".mui-slider-group").append("<div class='mui-slider-item Cloud-indicator mui-slider-item-duplicate'><a href='#'><img src='"+CloudArr[0]+"' /></a></div>")
	
		if(getActivityDetailArr.data.yunGouStatus==1 || getActivityDetailArr.data.yunGouStatus==2){
			var one=setInterval(function(){
				countTime(getActivityDetailArr.data.endTime)
			},1000)
		}else if(getActivityDetailArr.data.yunGouStatus==4){
			$(".CloundPurchaseDetailsTime>div:nth-child(2)").css({"background":"#911414","font-size":"1.333333rem","color":"#fff"})
			$(".CloundPurchaseDetailsTime>div:nth-child(2)").text("已退款")
			$(".CloundPurchaseDetailsBut,.CloundPurchaseDetailsNumber").remove()
			$(".CloundPurchaseDetailsCon").append(
				"<div class='CloundPurchaseDetailsText'>"+
					"<span>解散说明</span>"+
					"<p>因参与人数未达到开启标准，本次云购自动解散，已参与云购的通证已自动退回付款账户，详情进入我的记录查看退款信息！</p>"+
				"</div>"
			)
		}else if(getActivityDetailArr.data.yunGouStatus==3){
			getClearingResult(userId,token,clientType,language,CloudId)
			$(".CloundPurchaseDetailsTime>div:nth-child(2)").css({"background":"#911414","font-size":"1.333333rem","color":"#fff"})
			$(".CloundPurchaseDetailsTime>div:nth-child(2)").text("已结束")
			$(".CloundPurchaseDetailsBut,.CloundPurchaseDetailsNumber").remove()
			$(".CloundPurchaseDetailsCon").append(
				"<div class='CloundPurchaseDetailsText'>"+
					"<span>中奖名单</span>"+
					"<div class='CloudPurchaseDetailsTextBox'>"+
						"<div class='mui-scroll-wrapper' >"+
							"<div style='padding-bottom: 0;' class='mui-scroll '>"+
								"<div class='CloudDetailsTextBox'></div>"+
							"</div>"+
						"</div>"+
					"</div>"+
				"</div>"
			)
			mui('.mui-scroll-wrapper').scroll({
				 scrollY: true, //是否竖向滚动
				 scrollX: false, //是否横向滚动
				 startX: 0, //初始化时滚动至x
				 startY: 0, //初始化时滚动至y
				 indicators: false, //是否显示滚动条
				 deceleration:0.0006, //阻尼系数,系数越小滑动越灵敏
				 bounce: false, //是否启用回弹
			});
			getClearingResultArr.data.userIds.forEach(function(item){
				$(".CloudDetailsTextBox").append(
					"<div>"+item+"</div>"
				)
			})
		}
			
		if(getActivityDetailArr.data.yunGouStatus!=0){
			$(".CloundPurchaseDetailsBut").on("tap","button",function(){//购买
				$('#paymentCode').show();
			})
		}
	}
	
	window.onload = function() { 
		if(hehe==undefined){
			setTimeout(function(){
				$(".Gameload").hide()
			},1000)
		}
	}
	
	function RndNum(n){
	    var rnd="";
	    for(var i=0;i<n;i++)
	        rnd+=Math.floor(Math.random()*10);
	    return rnd;
	}
	function countTime(str){
		//获取当前时间
		var date=new Date();
		var now=date.getTime();
		//获取截取时间
//		var endDate=new Date(str);
		var end=str*1000;
		//获取时间差
		var LeftTime=end-now;
		//赋值
		var d,h,m,s;
		d=Math.floor(LeftTime/1000/60/60/24)
		h=Math.floor(LeftTime/1000/60/60%24)
		m=Math.floor(LeftTime/1000/60%60)
		s=Math.floor(LeftTime/1000%60)
		if(h<10){
			h="0"+h;
		}
		if(m<10){
			m="0"+m;
		}
		if(s<10){
			s="0"+s;
		}
		if(now>=end){
			clearInterval(one)
			$(".TimeBox>span:nth-child(1)").text("00:")
			$(".TimeBox>span:nth-child(2)").text("00:")
			$(".TimeBox>span:nth-child(3)").text("00")
			$(".CloundPurchaseDetailsBut>button").attr("disabled","disabled")
			$(".CloundPurchaseDetailsBut>button").css("opacity","1")
			var i=1;
			
			var two=setInterval(function(){
				$(".CloundPurchaseDetailsBut>button").text(RndNum(6))
				$(".CloundPurchaseDetailsBut>button").css("letter-spacing","10px")
				
				var date=new Date();
				var now=date.getTime();
				
				var twoDate=end+(i*60*1000)
				if(now>=twoDate){
					getClearingResult(userId,token,clientType,language,CloudId)
					if(getClearingResultArr.data.code==1){
						if(getClearingResultArr.data.status=="3"){
							clearInterval(two)
							window.location.reload()
						}else if(getClearingResultArr.data.status=="2"){
							i++
						}
					}else{
						clearInterval(two)
						$(".CloundPurchaseDetailsBut>button").text(getClearingResultArr.message)
					}
				}
			},10)
		}else{
			$(".TimeBox>span:nth-child(1)").text(h+":")
			$(".TimeBox>span:nth-child(2)").text(m+":")
			$(".TimeBox>span:nth-child(3)").text(s)
		}	
	}
	
	
		
	
	$(".CloudCut").on("tap",function(){
		var i=$(".CloundPurchaseDetailsNumber>input").val()
		if(i<=1){
			i=1
			$(".CloundPurchaseDetailsNumber>input").val(i)
		}else{
			i--
			$(".CloundPurchaseDetailsNumber>input").val(i)
		}
		
	})
	
	$(".CloudAdd").on("tap",function(){
		var i=$(".CloundPurchaseDetailsNumber>input").val()
		i++
		$(".CloundPurchaseDetailsNumber>input").val(i)
	})
	
	mui.ready(function() {
        // 数字索引
        var activeIndex = 0;
        // 密码结果
        var resultValue = "";
        // 所有输入框
        var inputList = mui(".input-item");
        // 所有数字键
        var numberList = mui(".keyboard-number");
        // 数字键盘点击事件
        mui("#keyboard").on("tap", ".keyboard-number", function() {
            if(activeIndex == 6) {
                return;
            }
            var num = this.innerText;
            addNumber(num);
        });
        mui("#keyboard").on("tap", ".keboard-action", function() {
            var value = this.getAttribute("data-action");
            switch(value) {
                case "cancel":
                    if(activeIndex == 0) {
                        return;
                    }
                    cancelNumber();
                    break;
                case "reset":
                    resetInput();
                    break;
                default:
                    break;
            }
        });
        // 添加数字
        function addNumber(num) {
            inputList[activeIndex].innerHTML = "<div></div>";
            resultValue += num;
            activeIndex++;
            // 检测密码长度
            
            if(activeIndex == 6) {
            	quantity=$(".CloundPurchaseDetailsNumber>input").val()
            	buy(userId,token,clientType,language,CloudId,quantity,resultValue)
				if(buyArr.code==1){
					alert("购买成功")
					$('#paymentCode').hide();
					$(".my_buyed_times").text(buyArr.data)
					$(".CloundPurchaseDetailsNumber>input").val("1")
					resetInput()
				}else{
					resetInput()
					alert(buyArr.message)
				}
            }
        }
        // 撤销数字
        function cancelNumber() {
            activeIndex--;
            inputList[activeIndex].innerText = "";
            resultValue = resultValue.substring(0, resultValue.length - 1);
        }
        // 密码框置空
        function resetInput() {
            activeIndex = 0;
            resultValue = "";
            mui(".input-item").each(function(index, element) {
                element.innerText = "";
            });
        }
        
        $("#close").on("tap",function(){
		   	$('#paymentCode').hide();
		   	resetInput();
		})
    });
		
</script>