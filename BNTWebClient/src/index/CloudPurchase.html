<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title data-value="">蚂蚁云购</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/swiper-3.4.2.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/index.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/iconfont.css"/>
	</head>
	<body>
			<div class="Gameload">
				<img src="../../img/WelfareDraw01.png" />
			</div>
			  <!--蚂蚁云购-->
			    <div class="Game">
			    	<div class="public-header">
			    		<div class="return">
			    			<div class="mui-push-left"></div>
			    			<span data-value="" class="">蚂蚁云购</span>
			    		</div>
			    	</div>
			    	<div class="GameRecordBox">
			    		<ul class="CrowdFundingState CloudStatu">
			    			<li>
			    				<div class="iconfont icon-jinhangzhong"></div>
			    				<span>进行中</span>
			    			</li>
			    			<li>
			    				<div class="iconfont icon-yijieshu"></div>
			    				<span>已结束</span>
			    			</li>
			    			<li>
			    				<div class="iconfont icon-jilu2-copy"></div>
			    				<span>我的记录</span>
			    			</li>
			    		</ul>
			    		<div class="GameRecordList01">
			    			<div class="mui-scroll-wrapper mui-content GaneRecordPage"  style="padding-bottom: 40px;">
								<div style="padding-bottom: 40px;" class="mui-scroll">
			    					<!--<div class="CloudConductPublicBox">
			    						<div class="CloudConductPublic">
			    							<div class="CloudPurchased">
			    								<span>已购:</span>
			    								<span>5000</span>
			    								<span>份</span>
			    							</div>
			    							<div class="CloudConductContent">
				    							<img src="../../img/CloudiPhoneX.png" />
				    							<div class="CloudConductContentRight">
				    								<p class="CloudConductTitle">Apple iPhone X</p>
				    								<span class="CloudConductDetailed">64GB 深空灰色 4G全网通</span>
				    								<div class="CloudConductPrice"><span>市场价：</span><span>8888 ¥</span></div>
				    								<div class="CloudConductNumber">
				    									<div><span>参与人数：</span><span>5000</span><span>份</span></div>
				    									<p>100ANT/份</p>
				    								</div>
				    								<div class="CloudConductTime">
				    									<span>揭晓日期:</span>
				    									<span>2018/12/30</span>
				    								</div>
				    							</div>
				    							<div class="CloudConductContentBack mui-push-right"></div>
				    						</div>
				    						<div class="CloudConductPublicStatu">火爆进行中</div>
			    						</div>
			    						
			    					</div>-->
			    				</div>
			    			</div>
			    		</div>
			    		<div class="GameRecordList02">
			    			<div class="mui-scroll-wrapper mui-content GaneRecordPage1"  style="padding-bottom: 40px;">
								<div style="padding-bottom: 40px;" class="mui-scroll">
			    					<!--<div class="CloudConductPublicBox">
			    						<div class="CloudConductPublic">
			    							<div class="CloudConductContent">
				    							<img src="../../img/CloudiPhoneX.png" />
				    							<div class="CloudConductContentRight">
				    								<p class="CloudConductTitle">Apple iPhone X</p>
				    								<span class="CloudConductDetailed">64GB 深空灰色 4G全网通</span>
				    								<div class="CloudConductPrice"><span>市场价：</span><span>8888 ¥</span></div>
				    								<div class="CloudConductNumber">
				    									<div><span>参与人数：</span><span>5000</span><span>份</span></div>
				    									<p>100ANT/份</p>
				    								</div>
				    								<div class="CloudConductTime">
				    									<span>已结束</span>
				    								</div>
				    							</div>
				    							<div class="CloudConductContentBack mui-push-right"></div>
				    						</div>
				    						<div style="background-color: rgba(204,204,204,0.8);" class="CloudConductPublicStatu">已结束</div>
			    						</div>
			    						
			    					</div>
			    					<div class="CloudConductPublicBox">
			    						<div class="CloudConductPublic">
			    							<div class="CloudConductContent">
				    							<img src="../../img/CloudiPhoneX.png" />
				    							<div class="CloudConductContentRight">
				    								<p class="CloudConductTitle">Apple iPhone X</p>
				    								<span class="CloudConductDetailed">64GB 深空灰色 4G全网通</span>
				    								<div class="CloudConductPrice"><span>市场价：</span><span>8888 ¥</span></div>
				    								<div class="CloudConductNumber">
				    									<div><span>参与人数：</span><span>5000</span><span>份</span></div>
				    									<p>100ANT/份</p>
				    								</div>
				    								<div class="CloudConductTime">
				    									<span>已结束</span>
				    								</div>
				    							</div>
				    							<div class="CloudConductContentBack mui-push-right"></div>
				    						</div>
				    						<div style="background-color: #565656;" class="CloudConductPublicStatu">活动已解散</div>
			    						</div>
			    					</div>-->
			    				</div>
			    			</div>
			    		</div>
			    		
			    	</div>
			    </div>
	</body>
</html>
<script type="text/javascript" src="../../js/jquery-3.3.1.min.js" ></script>
<script type="text/javascript" src="../../js/swiper-3.4.2.jquery.min.js" ></script>
<script type="text/javascript" src="../../js/mui.js" ></script>
<script type="text/javascript" src="../../js/rem.js" ></script>
<script type="text/javascript" src="../../js/ajax.js" ></script>
<script type="text/javascript" src="../../js/LanguagePackage.js" ></script>
<script type="text/javascript" src="../../js/language.js" ></script>
<script>
	var userId;
	var token;
	var clientType;
	var language;
	var pageNum=0;
	var CloundStatu=0;
	var selected=".GameRecordList01 .mui-scroll";
	var flag=true;
	
	if(localStorage.getItem("set-lan")=="EN"){
		language="en"
	}else{
		language="cn"
	}
	
	if(hehe!=undefined){
		$(".Gameload").hide()
	}else{
		userId=sessionStorage.getItem("userId")
		token=sessionStorage.getItem("token")
		clientType=2;
		CloudPurchaseFor()
	}
	
	function DAPPFrameworkEngineReady(){
		DAPPFramework.View.SetScrollEnabled(false);
		userId=DAPPFramework.Storage.Get("userId")
		token=DAPPFramework.Storage.Get("token")
		clientType=1;
		CloudPurchaseFor()
	}
	
	function formatDate1(now) {
	  　　var year = now.getFullYear(),
	  　　month = now.getMonth() + 1,
	  　　date = now.getDate(),
	  　　hour = now.getHours(),
	  　　minute = now.getMinutes(),
	  　　second = now.getSeconds();
	  	if(minute<10){
	  		minute="0"+minute
	  	}
	  	if(hour<10){
	  		hour="0"+hour
	  	}
	  　　return month + "/" + date +" "+ hour + ":" +minute;
	}
	
	function CloudPurchaseFor(){
		getActivityList(userId,token,clientType,language,pageNum,CloundStatu)
		
		getActivityListArr.data.forEach(function(item){
			var time=formatDate1(new Date(item.startTime*1000))
			if(CloundStatu==0){
				CloudPurchased="<span>已购:</span>"+"<span>"+item.buyedTimes+"</span>"+"<span>份</span>"
				CloudConductTime="<span>揭晓日期:</span>"+"<span>"+time+"</span>"
				if(item.yunGouStatus==0){
					CloudConductPublicStatu="未开启"
					CloudConductPublicStatuColor="1"
				}else if(item.yunGouStatus==2){
					CloudConductPublicStatu="正在开奖中"
					CloudConductPublicStatuColor="CloudColor01"
				}else{
					CloudConductPublicStatu="火爆进行中"
					CloudConductPublicStatuColor="1"
				}
			}else{
				CloudPurchased="";
				CloudConductTime="<span>已结束</span>"
				if(item.yunGouStatus==3){
					CloudConductPublicStatu="已结束"
					CloudConductPublicStatuColor="CloudColor02"
				}else{
					CloudConductPublicStatu="已退款"
					CloudConductPublicStatuColor="CloudColor03"
				}
			}
			
			$(selected).append(
				"<div class='CloudConductPublicBox' data-id="+item.id+">"+
					"<div class='CloudConductPublic'>"+
						"<div class='CloudPurchased'>"+CloudPurchased+"</div>"+
						"<div class='CloudConductContent'>"+
							"<img src='"+item.awards[0].awardSlavePictures+"' />"+
							"<div class='CloudConductContentRight'>"+
								"<p class='CloudConductTitle'>"+item.yunGouName+"</p>"+
								"<span class='CloudConductDetailed'>"+item.yunGouDesc+"</span>"+
								"<div class='CloudConductPrice'><span>市场价：</span><span>"+item.totalMarketPrice+" "+item.marketPriceUnit+"</span></div>"+
								"<div class='CloudConductNumber'>"+
									"<div><span>参与人数：</span><span>"+item.participants+"</span><span>人</span></div>"+
									"<p>"+item.totalAwardPriceAnt+"ANT/份</p>"+
								"</div>"+
								"<div class='CloudConductTime'>"+CloudConductTime+"</div>"+
							"</div>"+
							"<div class='CloudConductContentBack mui-push-right'></div>"+
						"</div>"+
						"<div class='CloudConductPublicStatu "+CloudConductPublicStatuColor+"'>"+CloudConductPublicStatu+"</div>"+
					"</div>"+
				"</div>"
			)
		})
	}
	
	$(document).ready(function  () {
		if(hehe==undefined){
			setTimeout(function(){
				$(".Gameload").hide()
			},500)
		}	
	})
	
	function getlotteryLogTopFor1(){
		var This=this;
		setTimeout(function(){
//			This.endPullupToRefresh(true);
			pageNum+=10;
			if(getActivityListArr.data.length!=10){
				This.endPullupToRefresh(true);
			}else{
				CloudPurchaseFor()
				This.endPullupToRefresh(false);
			}
		},2000)
	}
	
	mui.init({
		pullRefresh: {
			container: '.GaneRecordPage',
			up: {
				contentinit: '上拉显示更多',
                contentdown: '上拉显示更多',
                contentrefresh: '正在加载...',
                contentnomore: '已经全部加载完了...',
				callback: getlotteryLogTopFor1
			}
		}
	});
	
	mui.init({
		pullRefresh: {
			container: '.GaneRecordPage1',
			up: {
				contentinit: '上拉显示更多',
                contentdown: '上拉显示更多',
                contentrefresh: '正在加载...',
                contentnomore: '已经全部加载完了...',
				callback: getlotteryLogTopFor1
			}
		}
	});
	
	$(".CrowdFundingState>li").on("tap",function(){
		if($(this).find("span").text()!="我的记录"){			
			$(this).css("color","#00b07c").siblings().css("color","#b9b9b9")
		}
		
		switch ($(this).find("span").text()){
			case "进行中":
				$(".GameRecordList01").show()
				$(".GameRecordList02").hide()
				selected=".GameRecordList01 .mui-scroll"
				CloundStatu=0
				pageNum=0
				$(".GameRecordList01").find(".CloudConductPublicBox").remove()
				CloudPurchaseFor()
				break;
			case "已结束":
				$(".GameRecordList02").show()
				$(".GameRecordList01").hide()
				selected=".GameRecordList02 .mui-scroll"
				CloundStatu=1
				pageNum=0
				$(".GameRecordList02").find(".CloudConductPublicBox").remove()
				CloudPurchaseFor()
//				if(flag){
//					flag=false
//					CloudPurchaseFor()
//				}else{
//					return false
//				}
				break;
			case "我的记录":
				if(hehe!=undefined){
					DAPPFramework.View.PushView("src/index/CloudPurchaseRecord.html")
				}else{
					window.location.href="CloudPurchaseRecord.html"
				}
				break;
		}
	})
	
	$(".GameRecordList01,.GameRecordList02").on("tap",".CloudConductPublicBox",function(){
		var id=$(this).attr("data-id")
		if(hehe!=undefined){
			DAPPFramework.SharedBoard.Set("CloudId",id)
			DAPPFramework.View.PushView("src/index/CloudPurchaseDetails.html")
		}else{
			sessionStorage.setItem("CloudId",id)
			window.location.href="CloudPurchaseDetails.html"
		}
	})
</script>