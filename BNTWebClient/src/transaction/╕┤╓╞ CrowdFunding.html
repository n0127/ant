<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title data-value="Crowd-funding">众筹</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/swiper-3.4.2.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/index.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/iconfont.css"/>
		<script type="text/javascript" src="../../js/iconfont.js" ></script>
		<style type="text/css">
			.icon {
			   width: 1em; height: 1em;
			   vertical-align: -0.15em;
			   fill: currentColor;
			   overflow: hidden;
			   font-size:0.85rem;
			}
		</style>
	</head>
	<body>

			  <!--众筹-->
			    <div class="Game">
			    	<div class="public-header" style="display: none;">
			    		<div class="return">
			    			<div class="mui-push-left"></div>
			    			<span data-value="Crowd-funding" class="Explain-title">众筹</span>
			    		</div>
			    	</div>
			    	<div class="GameRecordBox">
			    		<ul class="CrowdFundingState">
			    			<li style="color:#00b07c ;">
			    				<div>
			    					<svg class="icon" aria-hidden="true">
									  <use xlink:href="#icon-naozhong1-copy"></use>
									</svg>
			    				</div>
			    				<span data-value="loging2.0_154">预热中</span>
			    			</li>
			    			<li>
			    				<div class="iconfont icon-jinhangzhong"></div>
			    				<span data-value="loging2.0_155">进行中</span>
			    			</li>
			    			<li>
			    				<div class="iconfont icon-yijieshu"></div>
			    				<span data-value="loging2.0_156">已结束</span>
			    			</li>
			    			<li>
			    				<div class="iconfont icon-jilu2-copy"></div>
			    				<span data-value="loging2.0_157">我的记录</span>
			    			</li>
			    		</ul>
			    		<div class="GameRecordList01">
			    			<div class="mui-scroll-wrapper mui-content GaneRecordPage"  style="padding-bottom: 40px;">
								<div style="padding-bottom: 40px;" class="mui-scroll">
			    					<!--<div class="CrowdFundingPublic">
			    						<div class="CrowdFundingPublicTop">
			    							<div class="CrowdFundingPublicTopImg">
			    								<img src="../../img/CrowdFunding05.png" />
			    							</div>
			    							<div class="CrowdFundingPublicTopRight">
			    								<div class="CrowdFundingPublicTopRight1">
			    									<div><span>ANT蚂蚁通证</span><span>预热中</span></div>
			    									<p>2018.11.29</p>
			    								</div>
			    								<ul class="CrowdFundingPublicTopRight2">
			    									<li>每个ID限购0000枚</li>
			    									<li>释放比例100.00%</li>
			    									<li>释放时间100天</li>
			    								</ul>
			    								<div class="CrowdFundingPublicTopRight3">接受币种：余额</div>
			    							</div>
			    						</div>
			    						<ul class="CrowdFundingPublicContent">
			    							<li>
			    								<span>众筹规模</span>
			    								<p>0000万</p>
			    							</li>
			    							<li>
			    								<span>价格</span>
			    								<p>0KT=?</p>
			    							</li>
			    							<li>
			    								<span>剩余时间</span>
			    								<p>未开始</p>
			    							</li>
			    						</ul>
			    						<div class="CrowdFundingPublicBottom">
			    							<div>
			    								<div class="CrowdFundingPublicBottomLine">
			    									<p><span style="width: 50%; background: red; display: inline-block; height: 0.277777rem; position: absolute;"></span></p>
			    									<span>0.00%</span>
			    								</div>
			    								
			    							</div>
			    							<button>立即购买</button>
			    						</div>
			    					</div>-->
			    				</div>
			    			</div>
			    		</div>
			    		<div class="GameRecordList02">
			    			<div class="mui-scroll-wrapper mui-content"  style="padding-bottom: 40px;">
								<div style="padding-bottom: 40px;" class="mui-scroll">
			    					<!--<div class="CrowdFundingPublic">
			    						<div class="CrowdFundingPublicTop">
			    							<div class="CrowdFundingPublicTopImg">
			    								<img src="../../img/CrowdFunding05.png" />
			    							</div>
			    							<div class="CrowdFundingPublicTopRight">
			    								<div class="CrowdFundingPublicTopRight1">
			    									<div><span>ANT蚂蚁通证</span><span>正在进行</span></div>
			    									<p>2018.11.29</p>
			    								</div>
			    								<ul class="CrowdFundingPublicTopRight2">
			    									<li>每个ID限购0000枚</li>
			    									<li>释放比例100.00%</li>
			    									<li>释放时间100天</li>
			    								</ul>
			    								<div class="CrowdFundingPublicTopRight3">接受币种：余额</div>
			    							</div>
			    						</div>
			    						<ul class="CrowdFundingPublicContent">
			    							<li>
			    								<span>众筹规模</span>
			    								<p>0000万</p>
			    							</li>
			    							<li>
			    								<span>价格</span>
			    								<p>0KT=?</p>
			    							</li>
			    							<li>
			    								<span>剩余时间</span>
			    								<p>进行中</p>
			    							</li>
			    						</ul>
			    						<div class="CrowdFundingPublicBottom">
			    							<div>
			    								<div class="CrowdFundingPublicBottomLine">
			    									<p></p>
			    									<span>0.00%</span>
			    								</div>
			    								
			    							</div>
			    							<button>立即购买</button>
			    						</div>
			    					</div>-->
			    				</div>
			    			</div>
			    		</div>
			    		<div class="GameRecordList03">
			    			<div class="mui-scroll-wrapper mui-content"  style="padding-bottom: 40px;">
								<div style="padding-bottom: 40px;" class="mui-scroll">
			    					<!--<div class="CrowdFundingPublic">
			    						<div class="CrowdFundingPublicTop">
			    							<div class="CrowdFundingPublicTopImg">
			    								<img src="../../img/CrowdFunding05.png" />
			    							</div>
			    							<div class="CrowdFundingPublicTopRight">
			    								<div class="CrowdFundingPublicTopRight1">
			    									<div><span>ANT蚂蚁通证</span><span class="status">已结束</span></div>
			    									<p>2018.11.29</p>
			    								</div>
			    								<ul class="CrowdFundingPublicTopRight2">
			    									<li>每个ID限购0000枚</li>
			    									<li>释放比例100.00%</li>
			    									<li>释放时间100天</li>
			    								</ul>
			    								<div class="CrowdFundingPublicTopRight3">接受币种：余额</div>
			    							</div>
			    						</div>
			    						<ul class="CrowdFundingPublicContent">
			    							<li>
			    								<span>众筹规模</span>
			    								<p>0000万</p>
			    							</li>
			    							<li>
			    								<span>价格</span>
			    								<p>0KT=?</p>
			    							</li>
			    							<li>
			    								<span>剩余时间</span>
			    								<p>已结束</p>
			    							</li>
			    						</ul>
			    						<div class="CrowdFundingPublicBottom">
			    							<div>
			    								<div class="CrowdFundingPublicBottomLine">
			    									<p></p>
			    									<span>0.00%</span>
			    								</div>
			    								
			    							</div>
			    							<button>立即购买</button>
			    						</div>
			    					</div>-->
			    				</div>
			    			</div>
			    		</div>
			    		<ul class="CrowdFundingRecord">
		    				<li data-value="loging2.0_158" class="CrowdFundingRecordLiActive">众筹记录</li>
		    			</ul>
		    			<ul class="CrowdFundingRecordState StateOne">
		    				<li data-value="loging2.0_159">类型</li>
		    				<li data-value="loging2.0_160">众筹数量</li>
		    				<li data-value="loging2.0_161">日期</li>
		    				<li data-value="loging2.0_162">金额</li>
		    			</ul>
			    		<div class="GameRecordList04">
			    			<div class="mui-scroll-wrapper mui-content"  style="padding-bottom: 40px;">
								<div style="padding-bottom: 40px;" class="mui-scroll">
			    					<ul class="CrowdFundingRecordBox">
			    						<!--<li>
			    							<span>众筹</span>
			    							<span>100ANT</span>
			    							<span>2015/11/29</span>
			    							<span>-188</span>
			    						</li>-->
			    					</ul>
			    				</div>
			    			</div>
			    		</div>
			    		<ul class="CrowdFundingRecordState StateTwo">
		    				<li>类型</li>
		    				<li>释放数量</li>
		    				<li>日期</li>
		    				<li>购买状态</li>
		    			</ul>
			    		<div class="GameRecordList05">
			    			<div class="mui-scroll-wrapper mui-content"  style="padding-bottom: 40px;">
								<div style="padding-bottom: 40px;" class="mui-scroll">
			    					<ul class="CrowdFundingRecordBox">
			    						<li>
			    							<span>释放 0.00000ANT</span>
			    							<span>100</span>
			    							<span>2015/11/29</span>
			    							<span style="color: #00b07c;">已完成</span>
			    						</li>
			    					</ul>
			    				</div>
			    			</div>
			    		</div>
			    	</div>
			    </div>
	</body>
</html>
<script type="text/javascript" src="../../js/jquery-3.3.1.min.js" ></script>
<!--<script type="text/javascript" src="../../js/swiper-3.4.2.jquery.min.js" ></script>-->
<script type="text/javascript" src="../../js/mui.js" ></script>
<script type="text/javascript" src="../../js/rem.js" ></script>
<script type="text/javascript" src="../../js/ajax.js" ></script>
<script type="text/javascript" src="../../js/LanguagePackage.js" ></script>
<script type="text/javascript" src="../../js/language.js" ></script>
<script>
	var userId;
	var token;
	var offset=0;
	var status=0;
	var flag=true;
	var id;
	function getlotteryLogTopFor1(){
		var This=this;
		setTimeout(function(){
			if(getZhongChouListArr.data!=undefined){				
				if(getZhongChouListArr.data.length>=10){
					offset+=10
					getZhongChouListFun()
					This.endPullupToRefresh(false);
				}else{				
					This.endPullupToRefresh(true);
				}
			}else{
				This.endPullupToRefresh(true);
			}
		},2000)
	}
	
	function formatDate(now) {
	  　　var year = now.getFullYear(),
	  　　month = now.getMonth() + 1,
	  　　date = now.getDate(),
	  　　hour = now.getHours(),
	  　　minute = now.getMinutes(),
	  　　second = now.getSeconds();
	  	if(minute<10){
	  		minute="0"+minute
	  	}
	  	if(hour<10){
	  		hour="0"+hour
	  	}
	  　　return year + "/" + month + "/" + date;
	}
	
	function formatDate1(now) {
	  　　var year = now.getFullYear(),
	  　　month = now.getMonth() + 1,
	  　　date = now.getDate(),
	  　　hour = now.getHours(),
	  　　minute = now.getMinutes(),
	  　　second = now.getSeconds();
	  	if(minute<10){
	  		minute="0"+minute
	  	}
	  	if(hour<10){
	  		hour="0"+hour
	  	}
	  　　return year + "/" + month + "/" + date + " " +hour+":"+minute;
	}
	var GetQueryString;
	if(hehe==undefined){
//		userId=sessionStorage.getItem("userId")
//		token=sessionStorage.getItem("token")
		userId=GetQueryString("user_id");
		token=GetQueryString("user_token");
		if(GetQueryString("language")=="en"){
			localStorage.setItem("set-lan","EN")
			langStart=0
			qiehuan()
		}else{
			localStorage.setItem("set-lan","CN")
			langStart=1
			qiehuan()
		}
		getZhongChouListFun()
	}
	
	//Dapp
	function DAPPFrameworkEngineReady(){
		DAPPFramework.View.SetScrollEnabled(false);
		userId=DAPPFramework.Storage.Get("userId")
		token=DAPPFramework.Storage.Get("token")
		getZhongChouListFun()	
	}
	
	
		
	function getZhongChouListFun(){
		if(status==0 || status==1 || status==2){
			getZhongChouList(userId,token,status,offset)
			if(getZhongChouListArr.data!=undefined){
				getZhongChouListArr.data.forEach(function(item){
					var time=formatDate1(new Date(item.startTime*1000))
					time=time.replace(/[/]/g,".")
					if(localStorage.getItem("set-lan")=="EN"){
						CrowdFundingText01="Limited per ID";
						CrowdFundingText02="Pie";
						CrowdFundingText03="Release ratio";
						CrowdFundingText04="Release time";
						CrowdFundingText05="Day";
						CrowdFundingText06="Accepted currency：";
						CrowdFundingText07="Crowdfunding scale";
						CrowdFundingText08="price";
						CrowdFundingText09="the remaining time";
						switch (item.status){
							case 0:
								statusText="has not started"
								statusSpan="<span>Preheating</span>"
								Button="<button disabled='disabled'>Buy now</button>";
								break;
							case 1:
								statusText="Ongoing"
								statusSpan="<span>"+statusText+"</span>"
								Button="<button style='background: #00b07c; color:#fff;'>Buy now</button>";
								break;
							case 2:
								statusText="Ended"
								statusSpan="<span style='background:#911414;'>"+statusText+"</span>"
								Button="<button disabled='disabled'>Buy now</button>";
								break;
							case 3:
								statusText="Released"
								break;
							case 4:
								statusText="Successful release"
								break;
							case 5:
								statusText="Release failure"
								break;
						}
					}else{
						switch (item.status){
							case 0:
								statusText="未开始"
								statusSpan="<span>预热中</span>"
								Button="<button disabled='disabled'>立即购买</button>";
								break;
							case 1:
								statusText="进行中"
								statusSpan="<span>"+statusText+"</span>"
								Button="<button style='background: #00b07c; color:#fff;'>立即购买</button>";
								break;
							case 2:
								statusText="已结束"
								statusSpan="<span style='background:#911414;'>"+statusText+"</span>"
								Button="<button disabled='disabled'>立即购买</button>";
								break;
							case 3:
								statusText="释放中"
								break;
							case 4:
								statusText="释放成功"
								break;
							case 5:
								statusText="释放失败"
								break;
						}
						CrowdFundingText01="每个ID限购";
						CrowdFundingText02="枚";
						CrowdFundingText03="释放比例";
						CrowdFundingText04="释放时间";
						CrowdFundingText05="天";
						CrowdFundingText06="接受币种：";
						CrowdFundingText07="众筹规模";
						CrowdFundingText08="价格";
						CrowdFundingText09="剩余时间";
					}
					$(".GameRecordList0"+(Number(status)+1)+">div>div").append(
						"<div class='CrowdFundingPublic' data-id='"+item.id+"'>"+
							"<div class='CrowdFundingPublicTop'>"+
								"<div class='CrowdFundingPublicTopImg'>"+
									"<img src='../../img/CrowdFunding05.png' />"+
								"</div>"+
								"<div class='CrowdFundingPublicTopRight'>"+
									"<div class='CrowdFundingPublicTopRight1'>"+
										"<div><span>"+item.targetCoinName+"</span>"+statusSpan+"</div>"+
										"<p>"+time+"</p>"+
									"</div>"+
									"<ul class='CrowdFundingPublicTopRight2'>"+
										"<li>"+CrowdFundingText01+item.perPersonLimit+CrowdFundingText02+"</li>"+
										"<li>"+CrowdFundingText03+(item.rate*100)+"%</li>"+
										"<li>"+CrowdFundingText04+item.releaseDays+CrowdFundingText05+"</li>"+
									"</ul>"+
									"<div class='CrowdFundingPublicTopRight3'>"+CrowdFundingText06+item.sourceCoinName+"</div>"+
								"</div>"+
							"</div>"+
							"<ul class='CrowdFundingPublicContent'>"+
								"<li>"+
									"<span>"+CrowdFundingText07+"</span>"+
									"<p>"+item.amount+"</p>"+
								"</li>"+
								"<li>"+
									"<span>"+CrowdFundingText08+"</span>"+
									"<p>1:"+item.rate+"</p>"+
								"</li>"+
								"<li>"+
									"<span>"+CrowdFundingText09+"</span>"+
									"<p>"+statusText+"</p>"+
								"</li>"+
							"</ul>"+
							"<div class='CrowdFundingPublicBottom'>"+
								"<div>"+
									"<div class='CrowdFundingPublicBottomLine'>"+
										"<p><span style='width: "+(Number(item.successRatio)*10000*100/10000).toFixed(2)+"%; background: #00b07c; display: inline-block; height: 0.333333rem; position: absolute; border-radius: 10px;'></span></p>"+
										"<span>"+(Number(item.successRatio)*10000*100/10000).toFixed(2)+"%</span>"+
									"</div>"+
								"</div>"+
								Button+
							"</div>"+
						"</div>"
					)
				})
			}
		}else{
			myRecord01()
		}
	}
	function getlotteryLogTopFor2(){
		var This=this;
		setTimeout(function(){
			if(getMyZhongChouBuyRecordArr.data.length>=10){
				offset+=10
				myRecord01()
				This.endPullupToRefresh(false);
			}else{				
				This.endPullupToRefresh(true);
			}
		},2000)
	}
	function getlotteryLogTopFor3(){
		var This=this;
		setTimeout(function(){
			if(getZhongChouReleaseRecordArr.data.length>=10){
				offset+=10
				myRecord01()
				This.endPullupToRefresh(false);
			}else{				
				This.endPullupToRefresh(true);
			}
		},2000)
	}
	function myRecord01(){
		getMyZhongChouBuyRecord(userId,token,offset)
		if(getMyZhongChouBuyRecordArr.data!=undefined){			
			getMyZhongChouBuyRecordArr.data.forEach(function(item){
				var time=formatDate(new Date(item.createTime*1000))
				$(".GameRecordList04 .CrowdFundingRecordBox").append(
					"<li>"+
						"<span>ANT COIN</span>"+
						"<span>"+item.targetAmount+"</span>"+
						"<span>"+time+"</span>"+
						"<span>-"+item.sourceAmount+"</span>"+
					"</li>"
				)
			})
		}
	}
	function myRecord02(){
		getZhongChouReleaseRecord(userId,token,offset)
		if(getZhongChouReleaseRecordArr.data!=undefined){			
			getZhongChouReleaseRecordArr.data.forEach(function(item){
				var time=formatDate(new Date(item.changeTime*1000))
				switch (item.status){
					case 0:
						statusText="失败"
						break;
					case 1:
						statusText="已完成"
						break;
				}
				$(".GameRecordList05 .CrowdFundingRecordBox").append(
					"<li>"+
						"<span>ANT COIN</span>"+
						"<span>"+item.amount+"</span>"+
						"<span>"+time+"</span>"+
						"<span>"+statusText+"</span>"+
					"</li>"
				)
			})
		}
	}
	
	$(".CrowdFundingState>li").on("tap",function(){
//		$(this).find("span").css("color","#00b07c").parent().siblings().find("span").css("color","#b9b9b9")
		$(this).css("color","#00B07C").siblings().css("color","#101010")
		switch ($(this).find("span").text()){
			case "预热中":
				$(".GameRecordList01").show()
				$(".GameRecordList01 .CrowdFundingPublic").remove()
				status=0;
				offset=0;
				getZhongChouListFun()
				$(".GameRecordList02,.GameRecordList03,.GameRecordList04,.CrowdFundingRecord,.CrowdFundingRecordState,.GameRecordList05").hide()
				break;
			case "Preheating":
				$(".GameRecordList01").show()
				$(".GameRecordList01 .CrowdFundingPublic").remove()
				status=0;
				offset=0;
				getZhongChouListFun()
				$(".GameRecordList02,.GameRecordList03,.GameRecordList04,.CrowdFundingRecord,.CrowdFundingRecordState,.GameRecordList05").hide()
				break;
			case "进行中":
				$(".GameRecordList02").show()
				$(".GameRecordList02 .CrowdFundingPublic").remove()
				status=1;
				offset=0;
				getZhongChouListFun()
				$(".GameRecordList01,.GameRecordList03,.GameRecordList04,.CrowdFundingRecord,.CrowdFundingRecordState,.GameRecordList05").hide()
				break;
			case "Ongoing":
				$(".GameRecordList02").show()
				$(".GameRecordList02 .CrowdFundingPublic").remove()
				status=1;
				offset=0;
				getZhongChouListFun()
				$(".GameRecordList01,.GameRecordList03,.GameRecordList04,.CrowdFundingRecord,.CrowdFundingRecordState,.GameRecordList05").hide()
				break;
			case "已结束":
				$(".GameRecordList03").show()
				$(".GameRecordList03 .CrowdFundingPublic").remove()
				status=2;
				offset=0;
				getZhongChouListFun()
				$(".GameRecordList01,.GameRecordList02,.GameRecordList04,.CrowdFundingRecord,.CrowdFundingRecordState,.GameRecordList05").hide()
				break;
			case "Ended":
				$(".GameRecordList03").show()
				$(".GameRecordList03 .CrowdFundingPublic").remove()
				status=2;
				offset=0;
				getZhongChouListFun()
				$(".GameRecordList01,.GameRecordList02,.GameRecordList04,.CrowdFundingRecord,.CrowdFundingRecordState,.GameRecordList05").hide()
				break;
			case "我的记录":
				$(".GameRecordList04").show()
				status=3;
				if(flag){
					flag=false;
					getZhongChouListFun()
				}
				$(".CrowdFundingRecord,.StateOne").css("display","flex")
				$(".GameRecordList01,.GameRecordList02,.GameRecordList03").hide()
				break;
			case "History":
				$(".GameRecordList04").show()
				status=3;
				if(flag){
					flag=false;
					getZhongChouListFun()
				}
				$(".CrowdFundingRecord,.StateOne").css("display","flex")
				$(".GameRecordList01,.GameRecordList02,.GameRecordList03").hide()
				break;
			}
		})
	$(".CrowdFundingRecord>li").on("tap",function(){
		$(this).addClass("CrowdFundingRecordLiActive").siblings().removeClass("CrowdFundingRecordLiActive")
		switch ($(this).text()){
			case "众筹记录":
				$(".GameRecordList04").show()
				$(".GameRecordList04 .CrowdFundingRecordBox>li").remove()
				status=3;
				offset=0;
				myRecord01()
				$(".StateOne").css("display","flex")
				$(".StateTwo,.GameRecordList05").hide()
				break;
			case "释放记录":
				$(".GameRecordList05").show()
				$(".GameRecordList05 .CrowdFundingRecordBox>li").remove()
				status=4;
				offset=0;
				myRecord02()
				$(".StateTwo").css("display","flex")
				$(".StateOne,.GameRecordList04").hide()
				break;
		}
	})
	
	mui(".GameRecordList01>div").pullRefresh({
		up: {
			contentinit: '上拉显示更多',
            contentdown: '上拉显示更多',
            contentrefresh: '正在加载...',
            contentnomore: '已经全部加载完了',
			callback: getlotteryLogTopFor1
		}
	})
	mui(".GameRecordList02>div").pullRefresh({
		up: {
			contentinit: '上拉显示更多',
            contentdown: '上拉显示更多',
            contentrefresh: '正在加载...',
            contentnomore: '已经全部加载完了',
			callback: getlotteryLogTopFor1
		}
	})
	mui(".GameRecordList03>div").pullRefresh({
		up: {
			contentinit: '上拉显示更多',
            contentdown: '上拉显示更多',
            contentrefresh: '正在加载...',
            contentnomore: '已经全部加载完了',
			callback: getlotteryLogTopFor1
		}
	})
	mui(".GameRecordList04>div").pullRefresh({
		up: {
			contentinit: '上拉显示更多',
            contentdown: '上拉显示更多',
            contentrefresh: '正在加载...',
            contentnomore: '已经全部加载完了',
			callback: getlotteryLogTopFor2
		}
	})
	mui(".GameRecordList05>div").pullRefresh({
		up: {
			contentinit: '上拉显示更多',
            contentdown: '上拉显示更多',
            contentrefresh: '正在加载...',
            contentnomore: '已经全部加载完了',
			callback: getlotteryLogTopFor3
		}
	})
	
	$(".GameRecordList01,.GameRecordList02,.GameRecordList03").on("tap",".CrowdFundingPublic",function(){
		id=$(this).attr("data-id")
		if(hehe!=undefined){
			DAPPFramework.View.PushView("src/transaction/CrowdFundingDetails.html?id="+id);
		}else{
			window.location.href="CrowdFundingDetails.html?id="+id
		}
	})
</script>